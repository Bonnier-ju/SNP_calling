#!/bin/bash
#SBATCH -p workq
#SBATCH --time=50:00:00 #job time limit
#SBATCH -J 06.2-LD_allele_freq #job name
#SBATCH -o /work/user/jbonnier/Dicorynia/full_workflow/00-batch_scripts/output/output-%x-%j.out #output file name
#SBATCH -e /work/user/jbonnier/Dicorynia/full_workflow/00-batch_scripts/error/error-%x-%j.out #error file name
#SBATCH --mem=100G #memory reservation
#SBATCH --cpus-per-task=8 #ncpu on the same node
#SBATCH --mail-user=julien.bonnier@ecofog.gf 
#SBATCH --mail-type=END,FAIL



##### Linkage desequilibrium & Minor alleles frequency #####
#########################################

echo "Linkage desequilibrium"

# Cleaning work place 
module purge

# Load the necessary modules
module load bioinfo/PLINK/1.90b7

# Define the paths
BINARY_TE_FILE="/work/user/jbonnier/Dicorynia/full_workflow/05-filtering_variants/05.4-transposable_element_filtering/filtered_TE_output"
OUTPUT_DIR="/work/user/jbonnier/Dicorynia/full_workflow/06-population_genetic/06.2-LD_allele_freq/wind_100000/LD_files"

# Perform linkage disequilibrium analysis
plink \
    --bfile ${BINARY_TE_FILE} \
    --allow-extra-chr \
    --r2 --with-freqs \
    --ld-window-kb 100000 \
    --indep-pairwise 100000 50000 0.99 \
    --out ${OUTPUT_DIR}
	
echo "End of LD computing" 

# Create binary file with pruned SNPs
plink \
    --bfile ${BINARY_TE_FILE} \
    --allow-extra-chr \
    --extract ${OUTPUT_DIR}.prune.in \
    --make-bed \
    --out ${OUTPUT_DIR}

echo "End of creating binary files of pruned SNPs"


#####--ld-window: This parameter defines the maximum number of variants to be considered when calculating the LD around a given SNP. 
#A value that is too high can significantly increase calculation time and include SNP pairs that are unlikely to be in significant LD, 
#while a value that is too low can exclude relevant SNP pairs.

#####--ld-window-kb: This parameter specifies the maximum physical window in kilobases in which the LD is calculated. 
#For example, setting this to 1000 means that PLINK will examine the LD between pairs of SNPs that are within 1 megabase of each other.

#####--ld-window-r2: This parameter defines the rÂ² threshold below which pairs of SNPs are not considered to be in significant LD. 
#A common threshold is 0.8 or 0.9, but this may depend on the specific purpose of your analysis. A higher threshold will select SNP pairs in stronger LD.

